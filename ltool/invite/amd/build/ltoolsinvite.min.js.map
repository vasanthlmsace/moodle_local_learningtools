{"version":3,"file":"ltoolsinvite.min.js","sources":["../src/ltoolsinvite.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Invite ltool define js.\n * @module   ltool_invite\n * @category  Classes - autoloading\n * @copyright 2021, bdecent gmbh bdecent.de\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n define(['jquery', 'core/modal_factory', 'core/str', 'core/fragment', 'core/modal_events', 'core/ajax', 'core/notification'],\n function($, ModalFactory, Str, Fragment, ModalEvents, Ajax, notification) {\n\n    /**\n     * Controls bookmarks tool action.\n     * @param {object} params\n     */\n    function learningToolInviteAction(params) {\n        showModalInvitetool(params);\n    }\n\n    /**\n     * Display the modal to invite user emails.\n     * @param {object} params\n     */\n    function showModalInvitetool(params) {\n        var inviteinfo = document.querySelector(\".ltoolinvite-info #ltoolinvite-action\");\n        if (inviteinfo) {\n            inviteinfo.addEventListener(\"click\", function() {\n                // Strinviteusers.\n                ModalFactory.create({\n                    title: params.strinviteusers,\n                    body: getInviteAction(params),\n                    large: true\n                }).then(function(modal) {\n                    modal.show();\n                    modal.getRoot().on(ModalEvents.bodyRendered, function() {\n                        var inviteuserForm = document.querySelector(\"#invite-users-area form\");\n                        if (inviteuserForm) {\n                            inviteuserForm.addEventListener('submit', function(e) {\n                                e.preventDefault();\n                                submitFormData(modal, params);\n                            });\n                        }\n                        var saveAction = document.querySelector(\"#inviteusers-action #save-action\");\n                        if (saveAction) {\n                            saveAction.addEventListener('click', function(e) {\n                                e.preventDefault();\n                                e.target.setAttribute(\"disabled\", true);\n                                document.querySelectorAll('#invite-users-area #inviteuser-action')[0].click();\n                            });\n                        }\n                        var cancelAction = document.querySelector(\"#inviteusers-action #cancel-action\");\n                        if (cancelAction) {\n                            cancelAction.addEventListener('click', function(e) {\n                                e.preventDefault();\n                                modal.destroy();\n                            });\n                        }\n                    });\n\n                    var footer = getFooterContent(params);\n                    modal.setFooter(footer);\n                    return modal;\n                }).catch(notification.exception);\n            });\n            // Hover color.\n            var invitehovercolor = inviteinfo.getAttribute(\"data-hovercolor\");\n            var invitefontcolor = inviteinfo.getAttribute(\"data-fontcolor\");\n            if (invitehovercolor && invitefontcolor) {\n                inviteinfo.addEventListener(\"mouseover\", function() {\n                    document.querySelector('#ltoolinvite-info p').style.background = invitehovercolor;\n                    document.querySelector('#ltoolinvite-info p').style.color = invitefontcolor;\n                });\n            }\n        }\n    }\n\n    /**\n     * Submit the modal data form.\n     * @param {object} modal object\n     * @param {array} params  list of parameters\n     * @return {void} ajax respoltoolsnse.\n     */\n    function submitFormData(modal, params) {\n        var modalform = document.querySelectorAll('#invite-users-area form')[0];\n        var formData = new URLSearchParams(new FormData(modalform)).toString();\n        var jsonparams = JSON.stringify(params);\n        Ajax.call([{\n            methodname: 'ltool_invite_inviteusers',\n            args: {params: jsonparams, formdata: formData},\n            done: function(response) {\n                if (response) {\n                    modal.hide();\n                    var successinfo = Str.get_string('successinviteusers', 'local_learningtools');\n                    $.when(successinfo).done(function(localizedEditString) {\n                        notification.addNotification({\n                            message: localizedEditString,\n                            type: \"success\"\n                        });\n                    });\n                    var listurl = M.cfg.wwwroot + \"/local/learningtools/ltool/invite/list.php?id=\" + params.user +\n                    \"&courseid=\" + params.course;\n                    window.open(listurl, '_self');\n                } else {\n                    modal.destroy();\n                }\n            }\n        }]);\n    }\n\n    /**\n     * Get invite user emails form.\n     * @param {object} params\n     * @return {string} textarea html\n     */\n    function getInviteAction(params) {\n        return Fragment.loadFragment('ltool_invite', 'get_inviteusers_form', params.contextid, params);\n    }\n    /**\n     * Display the list of invite users footer.\n     * @param {object} params\n     * @returns {string} footer block.\n     */\n    function getFooterContent(params) {\n        var content = '';\n        content += \"<div class='inviteusers-footer' id='inviteusers-footer'>\";\n        var listurl = M.cfg.wwwroot + \"/local/learningtools/ltool/invite/list.php?id=\" + params.user +\n        \"&courseid=\" + params.course;\n        if (params.showreports) {\n            content += \"<div id='list-action-url'><a href='\" + listurl + \"' target='_blank'>\" + params.strinvitelist + \"</a></div>\";\n        }\n        content += \"<div id='inviteusers-action' class='inviteusers-action'>\";\n        if (params.showinvitebox) {\n            content += \"<button id='save-action' type='button' class='btn btn-primary' data-action='save'>\"\n            + params.strinvitenow + \"</button>\";\n        }\n        content += \"<button id='cancel-action' type='button' class='btn btn-primary' data-action='cancel'>\"\n        + params.strcancel + \"</button>\";\n        content += \"</div>\";\n        content += \"</div>\";\n        return content;\n    }\n\n    return {\n        init: function(params) {\n            learningToolInviteAction(params);\n        }\n    };\n });"],"names":["define","$","ModalFactory","Str","Fragment","ModalEvents","Ajax","notification","learningToolInviteAction","params","inviteinfo","document","querySelector","addEventListener","create","title","strinviteusers","body","getInviteAction","large","then","modal","show","getRoot","on","bodyRendered","inviteuserForm","e","preventDefault","modalform","querySelectorAll","formData","URLSearchParams","FormData","toString","jsonparams","JSON","stringify","call","methodname","args","formdata","done","response","hide","successinfo","get_string","when","localizedEditString","addNotification","message","type","listurl","M","cfg","wwwroot","user","course","window","open","destroy","submitFormData","saveAction","target","setAttribute","click","cancelAction","footer","content","showreports","strinvitelist","showinvitebox","strinvitenow","strcancel","getFooterContent","setFooter","catch","exception","invitehovercolor","getAttribute","invitefontcolor","style","background","color","showModalInvitetool","loadFragment","contextid","init"],"mappings":";;;;;;;AAuBCA,mCAAO,CAAC,SAAU,qBAAsB,WAAY,gBAAiB,oBAAqB,YAAa,sBACvG,SAASC,EAAGC,aAAcC,IAAKC,SAAUC,YAAaC,KAAMC,uBAMhDC,yBAAyBC,kBAQLA,YACrBC,WAAaC,SAASC,cAAc,4CACpCF,WAAY,CACZA,WAAWG,iBAAiB,SAAS,WAEjCX,aAAaY,OAAO,CAChBC,MAAON,OAAOO,eACdC,KAAMC,gBAAgBT,QACtBU,OAAO,IACRC,MAAK,SAASC,OACbA,MAAMC,OACND,MAAME,UAAUC,GAAGnB,YAAYoB,cAAc,eACrCC,eAAiBf,SAASC,cAAc,2BACxCc,gBACAA,eAAeb,iBAAiB,UAAU,SAASc,GAC/CA,EAAEC,0BA4CNP,MAAOZ,YACvBoB,UAAYlB,SAASmB,iBAAiB,2BAA2B,GACjEC,SAAW,IAAIC,gBAAgB,IAAIC,SAASJ,YAAYK,WACxDC,WAAaC,KAAKC,UAAU5B,QAChCH,KAAKgC,KAAK,CAAC,CACPC,WAAY,2BACZC,KAAM,CAAC/B,OAAQ0B,WAAYM,SAAUV,UACrCW,KAAM,SAASC,aACPA,SAAU,CACVtB,MAAMuB,WACFC,YAAc1C,IAAI2C,WAAW,qBAAsB,uBACvD7C,EAAE8C,KAAKF,aAAaH,MAAK,SAASM,qBAC9BzC,aAAa0C,gBAAgB,CACzBC,QAASF,oBACTG,KAAM,mBAGVC,QAAUC,EAAEC,IAAIC,QAAU,iDAAmD9C,OAAO+C,KACxF,aAAe/C,OAAOgD,OACtBC,OAAOC,KAAKP,QAAS,cAErB/B,MAAMuC,cAhEMC,CAAexC,MAAOZ,eAG1BqD,WAAanD,SAASC,cAAc,oCACpCkD,YACAA,WAAWjD,iBAAiB,SAAS,SAASc,GAC1CA,EAAEC,iBACFD,EAAEoC,OAAOC,aAAa,YAAY,GAClCrD,SAASmB,iBAAiB,yCAAyC,GAAGmC,eAG1EC,aAAevD,SAASC,cAAc,sCACtCsD,cACAA,aAAarD,iBAAiB,SAAS,SAASc,GAC5CA,EAAEC,iBACFP,MAAMuC,oBAKdO,gBA+DM1D,YAClB2D,QAAU,GACdA,SAAW,+DACPhB,QAAUC,EAAEC,IAAIC,QAAU,iDAAmD9C,OAAO+C,KACxF,aAAe/C,OAAOgD,OAClBhD,OAAO4D,cACPD,SAAW,sCAAwChB,QAAU,qBAAuB3C,OAAO6D,cAAgB,cAE/GF,SAAW,2DACP3D,OAAO8D,gBACPH,SAAW,qFACT3D,OAAO+D,aAAe,oBAE5BJ,SAAW,yFACT3D,OAAOgE,UAAY,YACrBL,SAAW,SACXA,SAAW,SA/EcM,CAAiBjE,eAC9BY,MAAMsD,UAAUR,QACT9C,SACRuD,MAAMrE,aAAasE,kBAGtBC,iBAAmBpE,WAAWqE,aAAa,mBAC3CC,gBAAkBtE,WAAWqE,aAAa,kBAC1CD,kBAAoBE,iBACpBtE,WAAWG,iBAAiB,aAAa,WACrCF,SAASC,cAAc,uBAAuBqE,MAAMC,WAAaJ,iBACjEnE,SAASC,cAAc,uBAAuBqE,MAAME,MAAQH,oBAtDxEI,CAAoB3E,iBAkGfS,gBAAgBT,eACdL,SAASiF,aAAa,eAAgB,uBAAwB5E,OAAO6E,UAAW7E,cA2BpF,CACH8E,KAAM,SAAS9E,QACXD,yBAAyBC"}