/**
 * Time Management ltool define js.
 * @module   ltool_timemanagement
 * @copyright 2021, bdecent gmbh bdecent.de
 * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("ltool_timemanagement/managedates",["jquery","core/fragment","core/notification","core/templates","core/ajax","ltool_timemanagement/datepicker"],(function($,Fragment,notification,Templates,Ajax){var ManageDates=function(params){var self=this;self.params=params;var courseDueDateTypeInfo=document.querySelectorAll(self.courseDueDateTypeSelector)[0];courseDueDateTypeInfo&&courseDueDateTypeInfo.addEventListener("change",self.courseDueDateTypeHandler.bind(this)),self.bodyArea.classList.contains("timemanagement-managedates")&&self.bodyArea.classList.remove("timemanagement-managedates");var modStartDateTypeInfo=document.querySelectorAll(self.modStartDateTypeSelector);modStartDateTypeInfo&&modStartDateTypeInfo.forEach((item=>{item.addEventListener("change",self.modStartDateTypeHandler.bind(this))}));var modDueDateTypeInfo=document.querySelectorAll(self.modDueDateTypeSelector);modDueDateTypeInfo&&modDueDateTypeInfo.forEach((item=>{item.addEventListener("change",self.modDueDateTypeHandler.bind(this))}));var courseDueDateBlockInfo=document.querySelectorAll(self.courseDueDateBlockSelector);courseDueDateBlockInfo&&courseDueDateBlockInfo.forEach((item=>{item.addEventListener("change",self.courseDueDatecalculate.bind(this))}));var modStartDateDuration=document.querySelectorAll(self.modStartDateDurationSelector);modStartDateDuration&&modStartDateDuration.forEach((item=>{item.addEventListener("change",self.modStartDatecalculate.bind(this))}));var modDueDateDuration=document.querySelectorAll(self.modDueDateDurationSelector);modDueDateDuration&&modDueDateDuration.forEach((item=>{item.addEventListener("change",self.modDueDatecalculate.bind(this))})),document.querySelectorAll(self.datepickerSelector)&&$("input.datepicker").datepicker2({autoclose:!0,format:"yyyy/mm/dd"}).change((function(event){"enrolluserdate"==event.target.id&&(self.setPageDate(),self.changeCourseDueDate(),self.changeModStartDate(),self.changeModDueDate())}))};return ManageDates.prototype.bodyArea=document.querySelectorAll("body")[0],ManageDates.prototype.courseDueDateTypeSelector=".course-detail-block #course-due-date-info",ManageDates.prototype.courseDueDateBlockSelector=".course-detail-block .course-duedate-block .courseduedate",ManageDates.prototype.modStartDateTypeSelector=".course-detail-block .module-startdate",ManageDates.prototype.modStartDateDurationSelector=".course-detail-block .duration-date-selector .startdate-duration",ManageDates.prototype.modDueDateDurationSelector=".course-detail-block .duration-date-selector .duedate-duration",ManageDates.prototype.modDueDateTypeSelector=".course-detail-block .module-duedate",ManageDates.prototype.enrollUserDateSelector=".course-detail-block #enrolluserdate",ManageDates.prototype.datepickerSelector=".course-detail-block .datepicker",ManageDates.prototype.thisPage=".timemanagement-managedates .course-detail-block",ManageDates.prototype.changeCourseDueDate=function(){var courseduedateblock=document.querySelectorAll(".course-duedate-block")[0];if(courseduedateblock&&"after"==courseduedateblock.previousElementSibling.value){var durationSelector=courseduedateblock.querySelector(".duration-date-selector");this.courseManageDueDate(durationSelector)}},ManageDates.prototype.courseManageDueDate=function(durationSelector){var durationDigits=durationSelector.querySelector("input[name=course-duedate-digits]").value,durationType=durationSelector.querySelector("select[name=course-duedate-duration]").value;durationDigits&&durationType&&this.calculateuserdate("after",durationSelector,durationDigits+durationType)},ManageDates.prototype.courseDueDatecalculate=function(event){if("after"==event.target.closest(".course-duedate-block").previousElementSibling.value){let durationSelector=event.target.closest(".duration-date-selector");this.courseManageDueDate(durationSelector)}},ManageDates.prototype.changeModStartDate=function(){var self=this,modstartdateblock=document.querySelectorAll(".mod-startdates-block");modstartdateblock&&modstartdateblock.forEach((element=>{var type=element.previousElementSibling.value;if("after"==type){var durationSelector=element.querySelector(".duration-date-selector");self.modManageStartDate(durationSelector)}else if("upon"==type){var calcuateSelector=element.querySelector(".custom-date-selector").nextElementSibling;calcuateSelector.querySelector("span").innerHTML="",calcuateSelector.querySelector("span").innerHTML=self.getPageDate()}}))},ManageDates.prototype.changeModDueDate=function(){var self=this,modduedateblock=document.querySelectorAll(".mod-duedates-block");modduedateblock&&modduedateblock.forEach((element=>{if("after"==element.previousElementSibling.value){var durationSelector=element.querySelector(".duration-date-selector");self.modManageDueDate(durationSelector)}}))},ManageDates.prototype.modManageStartDate=function(durationSelector){var durationDigits=durationSelector.querySelector("#mod-startdate-digits").value,durationType=durationSelector.querySelector("#mod-startdate-duration").value;durationDigits&&durationType&&this.calculateuserdate("after",durationSelector,durationDigits+durationType)},ManageDates.prototype.modManageDueDate=function(durationSelector){var durationDigits=durationSelector.querySelector("#mod-duedate-digits").value,durationType=durationSelector.querySelector("#mod-duedate-duration").value;durationDigits&&durationType&&this.calculateuserdate("after",durationSelector,durationDigits+durationType)},ManageDates.prototype.modStartDatecalculate=function(event){if("after"==event.target.closest(".mod-startdates-block").previousElementSibling.value){let durationSelector=event.target.closest(".duration-date-selector");this.modManageStartDate(durationSelector)}},ManageDates.prototype.modDueDatecalculate=function(event){if("after"==event.target.closest(".mod-duedates-block").previousElementSibling.value){let durationSelector=event.target.closest(".duration-date-selector");this.modManageDueDate(durationSelector)}},ManageDates.prototype.setPageDate=function(){var enrolluserdate=document.querySelectorAll(this.enrollUserDateSelector)[0],modifyDate=enrolluserdate.value;enrolluserdate.setAttribute("data-value",modifyDate)},ManageDates.prototype.getPageDate=function(){return document.querySelectorAll(this.enrollUserDateSelector)[0].getAttribute("data-value")},ManageDates.prototype.getManagedatesContent=function(params){return Fragment.loadFragment("ltool_timemanagement","reload_managedates_content",params.contextid,params)},ManageDates.prototype.modDueDateTypeHandler=function(event){let type=event.target.value;var customSelector=event.target.nextElementSibling.querySelector(".custom-date-selector"),durationSelector=event.target.nextElementSibling.querySelector(".duration-date-selector"),calcuateSelector=customSelector.nextElementSibling;"custom"==type?(customSelector.classList.contains("d-none")&&customSelector.classList.remove("d-none"),durationSelector.classList.contains("d-none")||durationSelector.classList.add("d-none"),calcuateSelector.classList.contains("d-none")||calcuateSelector.classList.add("d-none")):"after"==type?(this.modManageDueDate(durationSelector),customSelector.classList.contains("d-none")||customSelector.classList.add("d-none"),durationSelector.classList.contains("d-none")&&durationSelector.classList.remove("d-none"),calcuateSelector.classList.contains("d-none")&&calcuateSelector.classList.remove("d-none")):(durationSelector.classList.contains("d-none")||durationSelector.classList.add("d-none"),customSelector.classList.contains("d-none")||customSelector.classList.add("d-none"),calcuateSelector.classList.contains("d-none")||calcuateSelector.classList.add("d-none"))},ManageDates.prototype.modStartDateTypeHandler=function(event){let type=event.target.value;var customSelector=event.target.nextElementSibling.querySelector(".custom-date-selector"),durationSelector=event.target.nextElementSibling.querySelector(".duration-date-selector"),calcuateSelector=customSelector.nextElementSibling;calcuateSelector.querySelector("span").innerHTML="","custom"==type?(customSelector.classList.contains("d-none")&&customSelector.classList.remove("d-none"),durationSelector.classList.contains("d-none")||durationSelector.classList.add("d-none"),calcuateSelector.classList.contains("d-none")||calcuateSelector.classList.add("d-none")):"after"==type?(this.modManageStartDate(durationSelector),customSelector.classList.contains("d-none")||customSelector.classList.add("d-none"),durationSelector.classList.contains("d-none")&&durationSelector.classList.remove("d-none"),calcuateSelector.classList.contains("d-none")&&calcuateSelector.classList.remove("d-none")):"upon"==type?(customSelector.classList.contains("d-none")||customSelector.classList.add("d-none"),durationSelector.classList.contains("d-none")||durationSelector.classList.add("d-none"),calcuateSelector.classList.contains("d-none")&&calcuateSelector.classList.remove("d-none"),calcuateSelector.querySelector("span").innerHTML="",calcuateSelector.querySelector("span").innerHTML=this.getPageDate()):(customSelector.classList.contains("d-none")||customSelector.classList.add("d-none"),durationSelector.classList.contains("d-none")||durationSelector.classList.add("d-none"),calcuateSelector.classList.contains("d-none")||calcuateSelector.classList.add("d-none"))},ManageDates.prototype.courseDueDateTypeHandler=function(event){let type=event.target.value;var customSelector=event.target.nextElementSibling.querySelector(".custom-date-selector"),durationSelector=event.target.nextElementSibling.querySelector(".duration-date-selector"),calcuateSelector=durationSelector.nextElementSibling;"custom"==type?(customSelector.classList.contains("d-none")&&customSelector.classList.remove("d-none"),durationSelector.classList.contains("d-none")||durationSelector.classList.add("d-none"),calcuateSelector.classList.contains("d-none")||calcuateSelector.classList.add("d-none")):"after"==type?(this.courseManageDueDate(durationSelector),durationSelector.classList.contains("d-none")&&durationSelector.classList.remove("d-none"),customSelector.classList.contains("d-none")||customSelector.classList.add("d-none"),calcuateSelector.classList.contains("d-none")&&calcuateSelector.classList.remove("d-none")):(durationSelector.classList.contains("d-none")||durationSelector.classList.add("d-none"),customSelector.classList.contains("d-none")||customSelector.classList.add("d-none"),calcuateSelector.classList.contains("d-none")||calcuateSelector.classList.add("d-none"))},ManageDates.prototype.calculateuserdate=function(type,currentselector){let time=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";var self=this,data={},date=self.getPageDate();data.pagedate=date,data.type=type,data.time=time,data.courseid=self.params.courseid,Ajax.call([{methodname:"ltool_timemanagement_update_managedates",args:{data:data},done:function(response){if(response){var info=currentselector.parentElement.querySelector("#calculate-date span");info.innerHTML="",info.innerHTML=response}}}])},{init:function(params){return new ManageDates(params)}}}));

//# sourceMappingURL=managedates.min.js.map