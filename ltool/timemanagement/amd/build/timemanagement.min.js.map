{"version":3,"file":"timemanagement.min.js","sources":["../src/timemanagement.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Time Management ltool define js.\n * @module   ltool_timemanagement\n * @copyright 2021, bdecent gmbh bdecent.de\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n define(['jquery', 'core/fragment', 'core/modal_factory', 'core/modal_events',\n    'core/notification', 'core/ajax', 'core/loadingicon'],\n function($, Fragment, ModalFactory, ModalEvents, Notification, Ajax, Loadingicon) {\n\n    /**\n     * Controls Time management tool action.\n     * @param {object} params\n     */\n    var LearningToolTimeManagement = function(params) {\n        var self = this;\n        self.params = params;\n        var timeManagementInfo = document.querySelector(\".ltooltimemanagement-info #ltooltimemanagement-action\");\n        if (self.bodyArea.classList.contains('timemanagment-modal')) {\n            self.bodyArea.classList.remove('timemanagment-modal');\n        }\n        if (timeManagementInfo) {\n             // Hover color.\n             var timeManagementhovercolor = timeManagementInfo.getAttribute(\"data-hovercolor\");\n             var timeManagementfontcolor = timeManagementInfo.getAttribute(\"data-fontcolor\");\n             if (timeManagementhovercolor && timeManagementfontcolor) {\n                timeManagementInfo.addEventListener(\"mouseover\", function() {\n                     document.querySelector('#ltooltimemanagement-info p').style.background = timeManagementhovercolor;\n                     document.querySelector('#ltooltimemanagement-info p').style.color = timeManagementfontcolor;\n                 });\n                 timeManagementInfo.addEventListener('click', function() {\n                    if (!self.bodyArea.classList.contains('timemanagment-modal')) {\n                        self.bodyArea.classList.add('timemanagment-modal');\n                    }\n                    self.displayTimeManagementBox(params);\n                });\n             }\n        }\n        var userSelectorBlock = document.querySelectorAll(self.userSelector)[0];\n        if (userSelectorBlock) {\n            userSelectorBlock.addEventListener(\"change\", self.changeUserHandler.bind(this, self));\n        }\n    };\n\n    LearningToolTimeManagement.prototype.bodyArea = document.querySelectorAll(\"body\")[0];\n\n    LearningToolTimeManagement.prototype.userSelector = '.time-management-header #user-select';\n\n    LearningToolTimeManagement.prototype.printSelector = '.time-management-header .print-block';\n\n    LearningToolTimeManagement.prototype.iconBlock = \".time-management-header .right-block .loading-icon\";\n\n    LearningToolTimeManagement.prototype.printHandler = function(themeurl, event) {\n        var mywindow = window.open('', 'PRINT', 'height=400,width=600');\n        mywindow.document.write('<html><head><title>' + document.title + '</title>');\n        mywindow.document.write('<link rel=\"stylesheet\" type=\"text/css\" href=\"' + themeurl + '\">');\n        mywindow.document.write('</head><body class=\"timemanagment-modal\">');\n        mywindow.document.write('<div class=\"modal-content' + event.target.className + '\">');\n        mywindow.document.write(document.querySelectorAll(\".modal-content\")[0].innerHTML);\n        mywindow.document.write('</div></body></html>');\n        mywindow.document.close();\n        mywindow.focus();\n        setTimeout(function() {\n            mywindow.print();\n        }, 1000);\n        return true;\n    };\n\n    LearningToolTimeManagement.prototype.changeUserHandler = function(self, event) {\n        var userid = event.target.value;\n        self.params.relateduser = userid;\n        Ajax.call([{\n            methodname: 'ltool_timemanagement_change_viewdates',\n            args: {data: self.params, type: 'header'},\n            done: function(response) {\n                $(\".timemanagment-modal .modal-header\").find(\".time-management-header\").replaceWith(response);\n                document.querySelector(\".time-management-header #user-select\").addEventListener(\"change\",\n                    self.changeUserHandler.bind(this, self));\n                var printSelectorBlock = document.querySelectorAll(self.printSelector)[0];\n                if (printSelectorBlock) {\n                    printSelectorBlock.addEventListener(\"click\", self.printHandler.bind(this, self.params.themeurl));\n                }\n            }\n        }]);\n\n        var promises = Ajax.call([{\n            methodname: 'ltool_timemanagement_change_viewdates',\n            args: {data: self.params, type: 'body'},\n            done: function(response) {\n                $(\".timemanagment-modal .modal-body\").find(\".viewcourse-date-block\").replaceWith(response);\n            }\n        }]);\n        Loadingicon.addIconToContainerRemoveOnCompletion(self.iconBlock, promises);\n    };\n\n    LearningToolTimeManagement.prototype.displayTimeManagementBox = function(params) {\n        var self = this;\n        ModalFactory.create({\n            title: self.getTimemanagementHeaderAction(params),\n            type: null,\n            body: self.getTimemanagementBodyAction(params),\n            large: true\n        }).then(function(modal) {\n            modal.show();\n            setTimeout(function() {\n                var userSelectorBlock = document.querySelectorAll(self.userSelector)[0];\n                if (userSelectorBlock) {\n                    userSelectorBlock.addEventListener(\"change\", self.changeUserHandler.bind(this, self));\n                }\n                var printSelectorBlock = document.querySelectorAll(self.printSelector)[0];\n                if (printSelectorBlock) {\n                    printSelectorBlock.addEventListener(\"click\", self.printHandler.bind(this, self.params.themeurl));\n                }\n            }, 5000);\n            modal.getRoot().on(ModalEvents.hidden, function() {\n                if (self.bodyArea.classList.contains('timemanagment-modal')) {\n                    self.bodyArea.classList.remove('timemanagment-modal');\n                }\n                modal.destroy();\n            });\n            modal.getRoot().on(ModalEvents.save, function(e) {\n                e.preventDefault();\n            });\n            return modal;\n        }).fail(Notification.exception);\n    };\n\n    LearningToolTimeManagement.prototype.getTimemanagementBodyAction = function(params) {\n        return Fragment.loadFragment('ltool_timemanagement', 'get_timemanagement_bodyform', params.contextid, params);\n    };\n\n    LearningToolTimeManagement.prototype.getTimemanagementHeaderAction = function(params) {\n        return Fragment.loadFragment('ltool_timemanagement', 'get_timemanagement_headerform', params.contextid, params);\n    };\n\n    return {\n        init: function(params) {\n            return new LearningToolTimeManagement(params);\n        }\n    };\n });"],"names":["define","$","Fragment","ModalFactory","ModalEvents","Notification","Ajax","Loadingicon","LearningToolTimeManagement","params","self","this","timeManagementInfo","document","querySelector","bodyArea","classList","contains","remove","timeManagementhovercolor","getAttribute","timeManagementfontcolor","addEventListener","style","background","color","add","displayTimeManagementBox","userSelectorBlock","querySelectorAll","userSelector","changeUserHandler","bind","prototype","printSelector","iconBlock","printHandler","themeurl","event","mywindow","window","open","write","title","target","className","innerHTML","close","focus","setTimeout","print","userid","value","relateduser","call","methodname","args","data","type","done","response","find","replaceWith","printSelectorBlock","promises","addIconToContainerRemoveOnCompletion","create","getTimemanagementHeaderAction","body","getTimemanagementBodyAction","large","then","modal","show","getRoot","on","hidden","destroy","save","e","preventDefault","fail","exception","loadFragment","contextid","init"],"mappings":"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"}